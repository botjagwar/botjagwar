language: python

python:
  - "3.8"

addons:
  apt:
    packages:
      - "python3"
      - "python3-pip"
      - "libssl-dev"
      - "wget"
      - "unzip"
      - "libsqlite3-dev"
      - "libxml2-dev"
      - "libxslt1-dev"
      - "redis-server"

sudo: required

os: linux
dist: bionic

# command to install dependencies
install:
  - python3 --version
  #- sudo ln -s $(which python3) /usr/bin/python3.6
  - sudo python3.8 -m pip install setuptools
  - sudo python3.8 -m pip install -r requirements.txt

# command to run tests
script:
  - cp -r conf/test_config.ini conf/config.ini
  - make install
  - cp -r test /opt/botjagwar/test
  - make prepare_tests
  - sudo python3.8 -m pip install nose
  - PYWIKIBOT2_NO_USER_CONFIG=1 sudo python3.8 -m "nose" -v /opt/botjagwar/test
  - make uninstall
